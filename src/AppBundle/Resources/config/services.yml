imports:
    - { resource: twitter.conf.yml }

services:
    # default configuration for services in *this* file
    _defaults:
        # automatically injects dependencies in your services
        autowire: true
        # automatically registers your services as commands, event subscribers, etc.
        autoconfigure: true
        # this means you cannot fetch services directly from the container via $container->get()
        # if you need to do this, you can override this setting on individual services
        public: false
    # MessageService definition, created by a Factory
    app.twitter_message_service:
        class:   AppBundle\Service\TwitterMessageService
        factory: ['AppBundle\Factory\MessageHandlerStaticFactory', createTwitterMessageService]
        arguments: ['%twitter.statuses.user_timeline.exclude_replies%','%twitter.statuses.user_timeline.include_rts%']
    # MessageService definition, created by a Factory
    app.message_handler:
        class:   AppBundle\Command\GetMessagesHandler
        arguments: ['@app.twitter_message_service','@cache.app.messages']
        tags:
            - { name: tactician.handler, command: AppBundle\Command\GetMessagesCommand }
        public: true
    # Controller as a service for FOSRest routes
    app.user_controller:
        class: AppBundle\Controller\UserController
        arguments:
            - '@tactician.commandbus'
    # Guzzle twitter emitter
    guzzle.twitter.emitter:
        class: GuzzleHttp\Event\Emitter
        calls:
            - [attach, ['@guzzle.twitter.oauthplugin']]
    # Guzzle twitter client
    GuzzleHttp\Client:
        arguments:
            - {base_url: ['%twitter.baseurl%', {version: '%twitter.version%'}], defaults: {auth: 'oauth'}, emitter: '@guzzle.twitter.emitter'}
    # Guzzle twitter oauth
    guzzle.twitter.oauthplugin:
        class: GuzzleHttp\Subscriber\Oauth\Oauth1
        arguments: ['%twitter.config%']
